/* eslint-disable no-use-before-define */
const settings = require('./safe/settings')
const namespace = require('./safe/namespace')

const readMeUrl = 'https://github.platforms.engineering/Velocity/profile-client'

const defaultHeader = () => {
    // next major version, inline into getAuthHeader.
    if (settings.authEnabled() && !getAuthHeader.logged) {
        console.error(`Profile Client: Auth token support not enabled. See ${readMeUrl}`)
        getAuthHeader.logged = true
    }

    return {}
}

const getAuthHeader = () => namespace.get('authHeader', defaultHeader)()

getAuthHeader.setValue = (headers) => namespace.set('authHeader', () => headers)
getAuthHeader.logged = false
getAuthHeader.init = () => {
    console.warn(
        `Profile Client: getAuthHeader.init is no longer required, and will be removed in a later version.`
    )
    return defaultHeader()
}

module.exports = getAuthHeader
