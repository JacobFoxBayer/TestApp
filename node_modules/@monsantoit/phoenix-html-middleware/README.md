# Phoenix HTML Middleware

This middleware (and helper functions) will take care of the generating of the standard main html that is used by a Phoenix project.  By using this library your project will automatically select the correct style if used in multiple suites (i.e. User Profile in Velocity and DevTools and PE Admin) without any additional configuration.

## Installation
`npm i @monsantoit/phoenix-html-middleware`

## Middleware usage
generateHtmlMiddleware(appBaseUrl, title, cookieNames, options)

Basic Example: 
```
const {generateHtmlMiddleware} = require('@monsantoit/phoenix-html-middleware')
const appBaseUrl = '/myapp' 

app.get(`/*`, generateHtmlMiddleware(appBaseUrl, 'My App Title', ['app-cookie-name-1', 'app-cookie-name-2'], {defaultSuite: 'velocity', libType: 'material', materialVersion: 0.41.0}))
```
### Params:
* appBaseUrl: The app's base url.
* title: The app's title.
* cookieNames:
An array of cookie names, these cookie names are used to pull a token from the request headers (note: Local ocelot is required for this to work).
### Options:
* defaultSuite: suite to resolve to if host does not match anything (or using localhost).  Defaults to **devtools**.
* i18n: If you're using the velocity translation libraries that put's locale & messages on the request object. Defaults to **false**.
* libType: What css library you are using.  Valid options are *material*, *bootstrap3*, *bootstrap4* and *element*.  Defaults to **material**.
* allFonts: When using libType *element*, setting this option to true will include additional font options (Filled, Outlined, Rounded, Two-Tone, and Sharp). Defaults to **false**  
* materialVersion: **Only if libType is *material***.  A version number of the material style you wish to use (ex. 0.41.0).  To see what versions we have generated styles for, visit the [Supported Material Style Versions](https://devtools.bayer.com/navigation/styles/material/supported) site.
* classes: value to use for the classname property of the body element. Defaults to **navbar-above**
 
### Advanced Options (use rarely)
* appStyleSuiteSpecific: Defaults to **false**. The middleware expects the stylesheet for the app to be at appBaseUrl/styles/style.css.  But if you have specific things for each suite, then you need to create a stylesheet for each suite in your appBaseUrl/styles path.  When that flag is set to true, it will use those suite specific stylesheets instead.
* additionalHostMap: Map of suite name to paths, should only use if we're behind updating this library, or we have a weird case we need to cover
    * ex: ```additionalHostMap = {'mysuite': ['mysuite.stuff.com', 'mysuite-np.stuff.com']```
* headHtml: Adds your custom html to the head area of the html, usually script tags.
* bodyHtml: Adds your custom html to the body area of the html, usually script tags.
* phoenixHome: Sets the root path to the assets site for the stylesheets.  Defaults to **phoenix-tools.io**.

## Generation of `suitesMap.json` file
During the build and test processes will be generated a `suitesMap.json` file by fetching all suites and their hosts. This aim to improve process of acquire proper suiteId while entering global support page from particular suite.
During tests all suites are fetched and saved in `suitesMap.json` file and test `test/readAndWriteSuitesMapFileSpec.js` will determine if content is accurate with the latest version. If fails, ex. some suite will change in time, developer need to review and update the test manually.

## Helper functions
In case the middleware isn't what you need, but want to use some of the logic in your own solution, the following has been provided:

### getSuiteStylesheetUrl(suite, options)
Generates the suite stylesheet url from the parameters.
 
Uses the *phoenix-home* and *libType* options defined above.

Basic:
```
const {getSuiteStylesheetUrl} = require('@monsantoit/phoenix-html-middleware')
const url = getSuiteStylesheetUrl('mysuite')
```

Advanced:
```
const {getSuiteStylesheetUrl} = require('@monsantoit/phoenix-html-middleware')
const options = {
    phoenixHome: 'phoenix-tools.io',
    libType: 'bootstrap'
}
const url = getSuiteStylesheetUrl('mysuite')
```

### getSuiteForHost(host, additionalHostMap, defaultSuite)
Figures out which suite is being used from the host provided.

Uses the *additionalHostMap* and *defaultSuite* options defined in the middleware.

Basic: 
```
const {getSuiteForHost} = require('@monsantoit/phoenix-html-middleware')
const suite = getSuiteForHost(host, {}, 'peadmin')
``` 

Advanced:
```
const {getSuiteForHost} = require('@monsantoit/phoenix-html-middleware')
const suite = getSuiteForHost(host, {'otherSuite': ['stuff.here.com']}, 'peadmin')
```