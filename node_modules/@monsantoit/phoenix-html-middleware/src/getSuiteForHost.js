const _ = require('lodash')
const {readSuitesMapFile} = require('./suitesMapFile/readAndWriteSuitesMapFile')

module.exports = (host = '', additionalHostMap = {}, defaultSuite = 'devtools') => {
    const defaultSuiteMap = readSuitesMapFile()
    const suiteMap = _.extend({}, additionalHostMap, defaultSuiteMap)
    const defaultKeys = Object.keys(defaultSuiteMap)

    const keySort = (val) => {
        if (defaultKeys.includes(val)) {
            return `0000${val}`
        }
        return `9999${val}`
    }

    const keys = _.sortBy(Object.keys(suiteMap), keySort)

    const matchPaths = (key) => suiteMap[key].includes(host)
    const matchInHost = (key) => host.includes(key)
    const found = keys.find(matchPaths) || keys.find(matchInHost)
    if (found) {
        return found
    }
    return defaultSuite
}
