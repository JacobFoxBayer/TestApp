const fs = require('fs')

const suiteMapJsonFile = 'suitesMap.json'
const suiteMapJsonFileFromNodeModules = require.resolve(`../../${suiteMapJsonFile}`)

const writeSuitesToFile = (mapedSuites) => {
    fs.writeFileSync(suiteMapJsonFile, JSON.stringify(mapedSuites, null, 4), (err) => {
        if (err) return console.log(`Unable to create ${suiteMapJsonFile} with suiteMap data`)
        return console.log(`Complete. Check ${suiteMapJsonFile} created`)
    })
}

const readSuitesMapFile = () => {
    let filePath = suiteMapJsonFile
    try {
        if (!fs.existsSync(filePath)) {
            filePath = suiteMapJsonFileFromNodeModules
        }
    } catch (err) {
        console.error(`File not exists in ${suiteMapJsonFile}, error:`, err)
    }

    let suitesMap = []
    try {
        suitesMap = JSON.parse(fs.readFileSync(filePath, 'utf8'))
    } catch (e) {
        console.warn(`Unable to read ${filePath}, error: ${e}`)
    }
    return suitesMap
}

module.exports = {
    suiteMapJsonFile,
    writeSuitesToFile,
    readSuitesMapFile,
}
