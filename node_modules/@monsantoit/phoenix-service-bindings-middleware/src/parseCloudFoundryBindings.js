'use strict'

function parseJson() {
    try {
        return JSON.parse(typeof process.env.VCAP_SERVICES === 'string' ? process.env.VCAP_SERVICES : '{}')
    } catch (error) {
        console.error('unable to parse VCAP_SERVICES:', error)
        return {}
    }
};

module.exports = function () {
    const bindings = {};
    const maybeAddBinding = function ({credentials, name}) {
        const alias = credentials.alias || name
        const value = credentials && alias ? credentials.url || credentials.value : null
        if (value) {
            return bindings[alias] = value
        }
    }

    const services = parseJson()['user-provided'] || []
    services.forEach((service) => {
        maybeAddBinding(service)
    })
    return bindings;
}
