const fs = require('fs');
const path = require('path');

/**
 * Handy object that parses and resolves filesystem paths.
 */

module.exports = {
    /**
     * Returns the absolute path to the repository's root directory on the local filesystem.
     * @return {string}
     */
    getProjectRootAbsolutePath() {
        return path.resolve(path.join(__dirname, '..'));
    },

    /**
     * Resolves zero or more path portions (relative to the project root) into a single absolute filesystem path.
     * @param {...string} pathPartsRelativeToProjectRoot Zero or more portions of a filesystem path.
     *   The first argument must be either a path relative to the project root (e.g., '/test/screenshot'),
     *   or an absolute path to an existing directory (e.g., '/Users/daisy/projects/test/screenshot').
     * @return {string}
     */

    getAbsolutePath(...pathPartsRelativeToProjectRoot) {
        // First argument is already an absolute path
        if (fs.existsSync(pathPartsRelativeToProjectRoot[0])) {
            return path.resolve(path.join(...pathPartsRelativeToProjectRoot));
        }

        // First argument is a path relative to the repo root
        const projectRootAbsolutePath = this.getProjectRootAbsolutePath();
        return path.resolve(
            path.join(
                projectRootAbsolutePath,
                ...pathPartsRelativeToProjectRoot
            )
        );
    },

    /**
     * Returns the path to a file relative to the given root.
     * @param absolutePathToFile
     * @param absolutePathToRoot
     * @return {string}
     */
    getRelativePath(
        absolutePathToFile,
        absolutePathToRoot = this.getProjectRootAbsolutePath()
    ) {
        return path.relative(absolutePathToRoot, absolutePathToFile);
    }
};
